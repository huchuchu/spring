# inflearn 스프링 입문/ 스프링 핵심원리로 학습한 내용

## 2021/01/31 
### 프로젝트 환경설정
&#35; JAVA 11
&#35; IDE : IntelliJ

* https://start.spring.io 로 프로젝트 생성 
* 스프링부트에 톰캣서버가 내장되어있기때문에 따로 설정은 해 주지않았다
  - 8080포트를 이미 사용중이어서 application.properties에 따로 설정을 해 주었다
  ```
  server.port = 8081
  ```
* gradle로 라이브러리를 관리 할 경우 필요한 라이브러리에 의존성 있는 라이브러리를 함께 다운로드한다
  - spring-boot-starter-web
    + spring-boot-starter-tomcat 톰캣(웹서버)
    + spring-webmvc : 스프링 웹 MVC
  - spring-boot-starter-thymeleaf : 타임리프 템플릿 엔진(View)
  - Spring-boot-starter(공통) : 스프링 부트 + 스프링코어 + 로깅
    + spring-boot
      + spring-core
    + spring-boot-starter-logging
      + logback, slf4j
    
  - 테스트 라이브러리
    + junit : 테스트 프레임워크
    + mockito : 목 라이브러리
    + assertj : 테스트코드를 좀 더 편하게 작성하게 도와주는 라이브러리
    + spring-test : 스프링 통합 테스트 지원
* 웰컴페이지 = resources/static/index.html 
* Controller에는 @Controller 어노테이션을 붙여준다
* Controller 메소드에는 @GetMapping 어노테이션을 붙여준다
* Model 객체에 data를 담아서 이동시킨다
* controller에서 리턴값으로 문자를 반환하면 뷰 리졸버가 화면을 찾아 처리한다
* build
  - 서버구동을 끄고 cmd창에서 프로젝트 디렉토리까지 들어간다
  - 나는 윈도우기때문에 gradlew.bat 실행 ( gradlew.bat build / gradlew.bat clean build)
  - 에러발생 :  Could not target platform: 'Java SE 11' using tool chain: 'JDK 8 (1.8)'
  - 인텔리제이에서는 다 변경해줬는데 또 에러가 나는 것으로 보아 환경변수쪽 문제 같아서 수정 후 재부팅 -> 빌드완료
  - build > libs 로 들어가서 hello-spring-0.0.1-SNAPSHOT.jar 생성된 것을 확인한 후 실행
  - java -jar hello-spring-0.0.1-SNAPSHOT.jar
  
  
  ## 2021/02/01
  ### 스프링 웹 개발 기초
  * 정적 컨텐츠 : 서버에서 뭐 하는 것 없이 파일을 그냥 웹브라우저에 내려주는 것
   - 스프링부트는 정적 컨텐츠 기능을 자동으로 제공한다
   - 순서 : 클라이언트가 정적페이지를 요청(localhost:8081/hello-static.html) -> 내장 톰캣서버가 요청을 받아 스프링으로 넘김 -> 컨트롤러에서 hello-static 이 있는지 찾음(컨트롤러가 우선순            위를 갖는다는 뜻 ) -> 없음 -> resources/static에서 hello-static을 찾음 -> 반환
   
   
   ![캡처](https://user-images.githubusercontent.com/58330668/106472341-e9ef6200-64e5-11eb-9326-62fccce4647c.jpg)
   
  
  * MVC와 템플릿 엔진 : Model, View, Controller
  
  
  ![캡처](https://user-images.githubusercontent.com/58330668/106472699-49e60880-64e6-11eb-869a-dd7b904a29e3.jpg)
  
  
  * API : 객체를 반환할 때 JSON형태로 내려줌
  @ResponseBody 사용 원리
    - HTTP BODY에 문자 내용을 직접 반환
    - 'viewResolver' 대신 'httpMessageConvert'가 동작
    - 기본 문자처리 : 'StringJttpMessageConverter'
    - 기본 객체처리 : 'MappingJackson2HttpMessageConverter'
      + Jackson : 객체를 JSON 으로 바꿔주는 유명 라이브러리 (Gson도 있는데 스프링에서는 Jackson 을 기본적으로 탑재함)
    - byte처리 등등 기타 여러 httpMessageconverter가 기본으로 등록되어있음
      + 클라이언트의 HTTP Accept해더와 서버의 컨트롤러 반환타입 정보 둘을 조합해서 'HttpMessageConverter'가 선택된다
        + HTTP Accept해더: 특정 데이터형식으로 요청할 수 있는데 그 정보가 담겨있음
        
        
   ## 21/02/02
   ### 테스트케이스 작성
   테스트 할 때 main메서드 통해서 실행하거나 컨트롤러를 통해 해당기능 실행. 이럴경우 준비하고 실행하는데 오래 걸리고, 반복 실행하기 어렵고 여러 테스트를 한번에 실행하기 어렵다는 단점이 있다.
   자나는 JUnit이라는 프레임워크로 테스트를 실행하여 이러한 문제점을 해결한다. 
   
   
   ## 21/02/03
   ### 스프링 빈과 의존관계
   회원관리(가입/로그인등)시 컨트롤러에서 모두 처리하는게 아니라 repository와 service를 통해서 하게되는데 이것을 의존관계라고한다
   ** controller에서 요청을받아 service에서 비즈니스로직처리 repository에서 저장하는게 일반적인 패턴
   controller --> Service --> Repository 로직을 위해선 이 세개를 연결해줘야하는데 그 때 사용되는게 __@Autowired__

   ```
   @Controller
    public class MemberController {

    private final MemberService memberService;

    @Autowired
    public MemberController(MemberService memberService) {
        this.memberService = memberService;
      }
    }
   
   ```
   
  생성자에 @Autowired를 붙이면 컨롤러가 생성이될 때 스프링에 들어있는 service객체를 딱 넣어줌! 이게 바로 __dependency injection__
  의존관계를 주입!!
  
  * 스프링 빈을 등록방법
    + 컴포넌트 스캔과 자동의존관계 설정
      - @Component 에노테이션이 있으면 스프링 빈으로 자동 등록된다
      - @Controller 컨트롤러가 스프링 빈으로 자동 등록된 이유도 컴포넌트 스캔때문이다
      - @Conponent 를 포함하는 다음 애노테이션도 스프링 빈으로 자동 등록된다
        ++ @controller , @Service , @Repository
  
  * 스프링은 스프링컨테이너에 스프링 빈을 등록할 때 기본적으로 싱글톤으로등록한다(유일하게 하나만 등록해서 공유) 따라서 같은 스프링 빈이면 모두 같은 인스턴스다. 
    설정으로 싱글톤이 아니게 할 수 있지만 특별한 경우를 제외하면 대부분 싱클톤이다
        
    + 자바 코드로 직접 스프링 빈 등록하기
      - SpringConfig파일 작성하기
  
  * DI 종류 : ** 생성자 주입**, 필드주입, setter주입. 의존관계가 실행중에 동적으로 변하는 경우는 거의 없으므로 생성자 주입을 권장한다
  * 정형화된 코드는 통 컴포넌트 스캔을 사용. 정형화 되지 않거나 상황에 따라 구현 클레스를 변경해야 하면 설정을 통해 스프링빈으로 등록한다
  * @Autowired를 통한 DI는 스프링이 관리하는 객체에서만 동작한다. 스프링 빈으로 등록하지않고내가 직접 생성한 객체에서는 동작안한다 
  
  ## 2021/02/04
  ### 스프링 DB접근 기술
  &#35; DB : h2
  
  *
  ```
  create table member
  (
   id bigint generated by default as identity,
   name varchar(255),
   primary key (id)
  );
  
  ```
   generated by default as identity : id값이 null로 DB에 들어와도 DB가 알아서 값을 셋팅해준다
   
   * jdbc
   &#42; 스프링 solid 추가로 알아보기
    - repository 클래스를 MemoryMemberRepository에서 JdbcMemberRepository로 변경했다
      + 개방-폐쇄원칙(OCP, Open-Closed Principle) : 확장에는 열려있고 수정,변경에는 닫혀있다
      + 스프링의 DI을 사용하면 __기존 코드를 전혀 손대지 않고, 설정만으로 구현 클래스를 변경__ 할 수 있다
   
   * 통합테스트
   @SpringBootTest : 스프링 컨테이너와 테스트를 함께 실행한다
   @Transactional : 테스트 시작 전에 트랜잭션을 시작하고, 테스트 완료 후에 항상 롤백한다. 이렇게 하면 DB에 데이터가 남지 않으므로 다음 테스트에 영향을 주지 않는다.
   @commit : 끝나면 커밋해준다
   
   * 스프링 jdbc템플릿
   순수 JDBC와 동일한 환경설정을 하면 된다
   스프링 JDBCTemplate과 MyBatis같은 라이브러리는 JDBC API에서 본 반복 코드를 대부분 제거해준다. 하지만 SQL은 직접 작성해야한다
   
   
